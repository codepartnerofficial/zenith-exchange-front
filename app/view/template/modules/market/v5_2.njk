<section class="v5-market-wrap">
    <style>
        .v5-market-wrap {
            width: 1200px;
            margin: 50px auto 0;
            border: 1px solid #e2e9ef;
            box-shadow: 0 4px 12px 0 rgba(0,0,0,0.1);
            border-radius: 4px;
            background: #fff;
            position: relative;
            font-family: DINPro-Medium;
        }
        .v5-market-wrap .market-item {
            height: 76px;
            line-height: 76px;
            padding: 0 40px;
            transition: all 0.3s;
            display: flex;
        }
        .v5-market-wrap .market-item:hover {
            background: #fff;
            box-shadow: 0 4px 12px 0 rgba(0,0,0,0.1);
            border-radius: 4px;
            margin: 0 -10px;
            padding: 0 56px;
        }
        .v5-market-wrap .market-item .market-info {
          display: flex;
          height: 76px;
          line-height: 76px;
          border-top: 1px solid #e2e9ef;
        }
        .v5-market-wrap .market-item:nth-child(2) .market-info {
          border-top: none;
        }
        .v5-market-wrap .market-item .td-item {
            font-size: 20px;
        }
        .v5-market-wrap .market-item .td-item1 {
            width: 50px;
            text-align: left;
            color: #828ea1;
        }
        .v5-market-wrap .market-item .td-item2 {
            width: 320px;
            padding-left: 0px;
            color: #aebacd;
        }
        .v5-market-wrap .market-item .td-item3 {
            width: 225px;
            color: #31363e;
        }
        .v5-market-wrap .market-item .td-item4 {
            width: 210px;
        }
        .v5-market-wrap .market-item .td-item-vol {
            width: 225px;
        }
        .v5-market-wrap .market-item .td-item-btn {
            width: 80px;
            font-size: 16px;
            text-align: right;
            position: relative;
        }
        .v5-market-wrap .market-item .td-item-btn button {
            background: #3f78ff;
            border-radius: 4px;
            width: 76px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            font-size: 14px;
            color: #fff;
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }
        .v5-market-wrap .market-item .td-item-btn button:hover {
            background: #5b8cff;
        }
        .v5-market-wrap .market-item .b-cion {
            font-size: 20px;
            color: #31363e;
            font-family: DINPro-Regular;
        }
        .v5-market-wrap .market-item .p-cion {
            font-size: 20px;
            color: #31363e;
            margin-right: 8px;
        }
        .v5-market-wrap .market-item .symbol-icon {
            margin-right: 20px;
        }
        .v5-market-wrap .market-item .symbol-icon img {
            vertical-align: middle;
            width: 32px;
            height: 32px;
        }
        .v5-market-wrap .market-item.title-th {
            height: 55px;
            line-height: 55px;
            font-family: DINPro-Regular;
            border-bottom: 1px solid #e2e9ef;
        }
        .v5-market-wrap .market-item.title-th .td-item2 {
            box-sizing: border-box;
            padding-left: 50;
        }
        .v5-market-wrap .market-item.title-th .td-item {
            font-size: 12px;
            color: #aebacd;
        }
        .v5-market-wrap .market-item.title-th .td-item-vol {
            padding: 0;
        }
        .v5-market-wrap .market-item.title-th:hover {
            background: #fff;
            box-shadow: none;
            border-radius: 0;
            margin: 0;
            padding: 0 40px;
        }
        .v5-market-wrap .more {
            height: 52px;
            line-height: 52px;
            text-align: center;
        }
        .v5-market-wrap .more span {
            font-size: 14px;
            color: #3f78ff;
            cursor: pointer;
        }
        .v5-market-wrap .more span:hover {
            color: #5b8cff;
        }
    </style>
    <ul class="market-ul market-wrap">
        <li class="market-item title-th">
            <div class="td-item td-item1">#</div>
            <div class="td-item td-item2">{{locale.home.market}}</div>
            <div class="td-item td-item3">{{locale.home.close}}</div>
            <div class="td-item td-item4">{{locale.home.applies}}</div>
            <div class="td-item td-item-vol">{{locale.home.H_volume}}</div>
            <div class="td-item td-item-btn">{{locale.h5Add.tradeList1}}</div>
        </li>
        {% for item in recommendMarket %}
        {% if helper.recommend.symbolShow(loop.index0) %}
        <li class="market-item market-content" data-coin="{{item}}">
          <div class="market-info">
            <div class="td-item td-item1">{{loop.index}}</div>
            <div class="td-item td-item2">
                {% if helper.recommend.symbolIcon(item, coinList)%}
                <span class="symbol-icon">
                    <img src="{{helper.recommend.symbolIcon(item, coinList)}}" alt="">
                </span>
                {% endif %}
                <span class="b-cion">{{helper.recommend.setSymbol(helper.recommend.getCoinShowName(item, symbolAll), 'q')}}</span>
                <span class="q-cion">{{helper.recommend.setSymbol(helper.recommend.getCoinShowName(item, symbolAll), 'b')}}</span>
            </div>
            <div class="td-item td-item3 closePrice"></div>
            <div class="td-item td-item4 percentage"></div>
            <div class="kline td-item td-item-vol"></div>
            <div class="td-item td-item-btn">
                <button class="common-button common-button-solid u-8-bg u-16-cl">
                    {{locale.otcTrade.buy}}
                </button>
            </div>
          </div>
        </li>
        {% endif %}
        {% endfor %}
        <li class="more">
            <span>{{locale.home.moreMarket}}ï¼ž</span>
        </li>
    </ul>
    <script>
        (() => {
            const { myStorage } = window.BlockChainUtils;
            const websocketPath = "{{sourceMap.webSocket}}";
            if (!window.RecommendExtend){
                class RecommendExtend {
                    constructor() {
                      this.init();
                      this.bindMoreEvent();
                    }

                    init() {
                      this.$marketWrap = document.querySelector('.v5-market-wrap');
                      this.$marketList = Array.prototype.slice.call(this.$marketWrap.querySelectorAll('.market-content'));
                      this.domTree = {};
                      this.setDomTree();
                      window.emitter.on('MARKET-DATA', (data) => {
                        this.setData(data);
                      })
                    }

                    setDomTree() {
                      this.$marketList.forEach((item) => {
                        const { coin } = item.dataset;
                        if (coin) {
                          if (!this.domTree[coin]) {
                            this.domTree[coin] = {};
                          }
                          this.domTree[coin].closePrice = item.querySelector('.closePrice');
                          this.domTree[coin].percentage = item.querySelector('.percentage');
                          this.domTree[coin].vol = item.querySelector('.td-item-vol');
                          this.domTree[coin].btn = item.querySelector('.td-item-btn');
                          this.domTree[coin].btn.addEventListener('click', () => {
                            let symbol = coin;
                            if (coin) {
                              if (coin.indexOf('-c') > -1) {
                                symbol = coin.replace('-c', '');
                              }
                              myStorage.set('sSymbolName', symbol);
                              myStorage.set('markTitle', symbol.split('/')[1]);
                            }
                            const { symbolAll } = window.market;
                            let sSymbolShowName = symbol;
                            if (symbolAll[symbol] && symbolAll[symbol].showName) {
                              sSymbolShowName = symbolAll[symbol].showName;
                            }
                            window.location.href = `/trade/${sSymbolShowName.replace('/', '_')}`;
                          })
                        }
                      });
                    }

                    setData(data) {
                      data.forEach((item) => {
                        const symbol = item.showName;
                        if (this.domTree[symbol]) {
                          this.domTree[symbol].closePrice.innerHTML = item.data[1][0].text;
                          this.domTree[symbol].closePrice.className = `td-item td-item3 closePrice ${item.data[1][0].classes.join(' ')}`;
                          this.domTree[symbol].percentage.innerHTML = item.data[2][0].text;
                          this.domTree[symbol].percentage.className = `td-item td-item4 percentage ${item.data[2][0].classes.join(' ')}`;
                          this.domTree[symbol].vol.innerHTML = item.data[6][0].text;
                        }
                      })
                    }

                    bindMoreEvent(){
                        this.$marketWrap.querySelector('.more').addEventListener('click', () => {
                            window.location.href = '/trade';
                        }, false);
                    }
                }
                window.RecommendExtend = RecommendExtend;
                new RecommendExtend();
            }
            if (websocketPath && !window.selfSocket){
                window.selfSocket = true;
                getScript(`${window.staticDomain}/home/static/${websocketPath}`);
            }
        })();
    </script>
</section>
